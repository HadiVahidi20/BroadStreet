<!--
  Broadstreet Fixtures & Results (Google Sheets) - GoHighLevel Custom HTML Snippet

  How to use:
  1) Paste this entire block into a GHL "Custom HTML" element.
  2) Set the CONFIG values below.
-->

<style>
  .bs-fixtures { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; max-width: 900px; margin: 0 auto; }
  .bs-fixtures h2 { margin: 0 0 16px; font-size: 24px; }
  .bs-fixture-row { display: flex; align-items: center; gap: 12px; padding: 14px 16px; border: 1px solid rgba(0,0,0,0.1); border-radius: 10px; margin-bottom: 10px; background: #fff; }
  .bs-fixture-date { min-width: 100px; font-size: 13px; opacity: 0.7; }
  .bs-fixture-teams { flex: 1; font-weight: 600; }
  .bs-fixture-vs { opacity: 0.5; margin: 0 6px; font-weight: 400; }
  .bs-fixture-score { font-size: 18px; font-weight: 700; color: #1a1a2e; min-width: 60px; text-align: center; }
  .bs-fixture-info { font-size: 12px; opacity: 0.6; min-width: 120px; text-align: right; }
  .bs-fixture-badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; text-transform: uppercase; }
  .bs-fixture-badge--upcoming { background: #e3f2fd; color: #1565c0; }
  .bs-fixture-badge--completed { background: #e8f5e9; color: #2e7d32; }
  @media (max-width: 640px) {
    .bs-fixture-row { flex-wrap: wrap; }
    .bs-fixture-info { width: 100%; text-align: left; margin-top: 4px; }
  }
</style>

<section class="bs-fixtures" data-bs-fixtures>
  <h2>Upcoming Fixtures</h2>
  <div data-bs-fixtures-upcoming><p style="opacity:.7">Loading fixtures...</p></div>
  <h2 style="margin-top:24px">Recent Results</h2>
  <div data-bs-fixtures-results><p style="opacity:.7">Loading results...</p></div>
</section>

<script>
(function () {
  var CONFIG = {
    apiKey: "AIzaSyDeLiOcwEJuu8sCt6UjN74-Q9pvNljeoq4",
    sheetId: "1DT5Xti6N6uc9XgXJENQuF7B29uCAVwEQYQX3F6WRVc0",
    range: "fixtures!A1:Z",
  };

  function esc(s) {
    return String(s || "").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");
  }

  function normalizeHeader(h) { return String(h||"").trim().toLowerCase().replace(/\s+/g,"_"); }

  function rowsToObjects(values) {
    if (!Array.isArray(values)||values.length<2) return [];
    var headers = values[0].map(normalizeHeader);
    var out = [];
    for (var i=1;i<values.length;i++) {
      var row = values[i]; if (!row||row.every(function(c){return String(c||"").trim()==="";})) continue;
      var obj = {};
      for (var c=0;c<headers.length;c++) { if(!headers[c]) continue; obj[headers[c]]=row[c]!=null?row[c]:""; }
      out.push(obj);
    }
    return out;
  }

  async function fetchSheet() {
    var url = "https://sheets.googleapis.com/v4/spreadsheets/" + encodeURIComponent(CONFIG.sheetId) + "/values/" + encodeURIComponent(CONFIG.range) + "?key=" + encodeURIComponent(CONFIG.apiKey) + "&majorDimension=ROWS";
    var resp = await fetch(url, {headers:{accept:"application/json"}});
    if (!resp.ok) throw new Error("Sheets API "+resp.status);
    return resp.json();
  }

  function render(root, fixtures) {
    var upcoming = fixtures.filter(function(f){return f.status==="upcoming";});
    var completed = fixtures.filter(function(f){return f.status==="completed";}).slice(-5).reverse();

    var upEl = root.querySelector("[data-bs-fixtures-upcoming]");
    var resEl = root.querySelector("[data-bs-fixtures-results]");

    if (upEl) {
      upEl.innerHTML = upcoming.length ? upcoming.map(function(f) {
        return '<div class="bs-fixture-row">' +
          '<div class="bs-fixture-date">' + esc(f.date) + '<br>' + esc(f.time) + '</div>' +
          '<div class="bs-fixture-teams">' + esc(f.home_team) + '<span class="bs-fixture-vs">vs</span>' + esc(f.away_team) + '</div>' +
          '<div class="bs-fixture-info"><span class="bs-fixture-badge bs-fixture-badge--upcoming">Upcoming</span><br>' + esc(f.venue) + '</div>' +
          '</div>';
      }).join("") : "<p style='opacity:.7'>No upcoming fixtures.</p>";
    }

    if (resEl) {
      resEl.innerHTML = completed.length ? completed.map(function(f) {
        return '<div class="bs-fixture-row">' +
          '<div class="bs-fixture-date">' + esc(f.date) + '</div>' +
          '<div class="bs-fixture-teams">' + esc(f.home_team) + '<span class="bs-fixture-vs">vs</span>' + esc(f.away_team) + '</div>' +
          '<div class="bs-fixture-score">' + esc(f.home_score) + ' - ' + esc(f.away_score) + '</div>' +
          '<div class="bs-fixture-info"><span class="bs-fixture-badge bs-fixture-badge--completed">FT</span></div>' +
          '</div>';
      }).join("") : "<p style='opacity:.7'>No results yet.</p>";
    }
  }

  async function init() {
    var root = document.querySelector("[data-bs-fixtures]");
    if (!root) return;
    try {
      var data = await fetchSheet();
      render(root, rowsToObjects(data.values));
    } catch(e) { try{console.error(e);}catch(x){} }
  }

  if (document.readyState==="loading") document.addEventListener("DOMContentLoaded",init); else init();
})();
</script>
